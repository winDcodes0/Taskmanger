<!DOCTYPE html>
<html>
<head>
<title>Ultimate Task Manager</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Excel Export Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

body{
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#141e30,#243b55);
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    padding:20px;
    color:white;
}

.app{
    width:100%;
    max-width:500px;
    background:rgba(255,255,255,0.1);
    backdrop-filter:blur(15px);
    padding:25px;
    border-radius:20px;
    box-shadow:0 20px 40px rgba(0,0,0,0.5);
}

h2{
    text-align:center;
    margin-bottom:20px;
}

.top-row{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
}

input, select{
    flex:1;
    padding:10px;
    border-radius:8px;
    border:none;
    font-size:15px;
}

button{
    padding:10px 14px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
}

.add-btn{ background:#1cc88a; color:white; }
.remove-btn{ background:#e74a3b; color:white; }
.edit-btn{ background:#f6c23e; color:black; }

ul{
    list-style:none;
    margin-top:20px;
}

li{
    background:rgba(255,255,255,0.15);
    padding:12px;
    margin-bottom:10px;
    border-radius:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    flex-wrap:wrap;
    gap:10px;
    cursor:grab;
}

.completed{
    text-decoration:line-through;
    opacity:0.6;
}

.button-group{
    display:flex;
    gap:5px;
}

.progress{
    height:8px;
    background:#444;
    border-radius:5px;
    margin-top:20px;
}

.progress-bar{
    height:8px;
    background:#1cc88a;
    border-radius:5px;
    width:0%;
    transition:0.4s;
}

.bottom-buttons{
    display:flex;
    gap:10px;
    margin-top:15px;
    flex-wrap:wrap;
}

/* Mobile */
@media(max-width:480px){

    body{
        align-items:flex-start;
        padding-top:40px;
    }

    li{
        flex-direction:column;
        align-items:flex-start;
    }

    .button-group{
        align-self:flex-end;
    }
}
</style>
</head>

<body>

<div class="app">

<h2>âš¡ Ultimate Task Manager</h2>

<div class="top-row">
<input type="text" id="taskInput" placeholder="Enter task">
<select id="category">
<option>Work</option>
<option>Study</option>
<option>Personal</option>
</select>
<button class="add-btn" onclick="addTask()">Add</button>
</div>

<ul id="taskList"></ul>

<div class="progress">
<div class="progress-bar" id="progressBar"></div>
</div>

<div class="bottom-buttons">
<button class="remove-btn" onclick="clearCompleted()">Clear Completed</button>
<button class="add-btn" onclick="exportToExcel()">Export Excel</button>
</div>

</div>

<script>

let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

function save(){
    localStorage.setItem("tasks",JSON.stringify(tasks));
}

function addTask(){
    let text = taskInput.value.trim();
    let category = categorySelect = document.getElementById("category").value;

    if(text==="") return;

    tasks.push({
        text,
        category,
        completed:false
    });

    taskInput.value="";
    save();
    display();
}

function display(){

    taskList.innerHTML="";
    let completedCount=0;

    tasks.forEach((task,index)=>{

        let li = document.createElement("li");
        li.draggable=true;

        li.ondragstart=()=>dragStart(index);
        li.ondragover=(e)=>e.preventDefault();
        li.ondrop=()=>drop(index);

        let span = document.createElement("span");
        span.innerHTML=`<strong>${task.text}</strong><br>
        <small>${task.category}</small>`;

        if(task.completed){
            span.classList.add("completed");
            completedCount++;
        }

        span.onclick=()=>{
            tasks[index].completed=!tasks[index].completed;
            save();
            display();
        };

        let editBtn=document.createElement("button");
        editBtn.innerText="Edit";
        editBtn.classList.add("edit-btn");
        editBtn.onclick=()=>{
            let newText=prompt("Edit task:",task.text);
            if(newText){
                tasks[index].text=newText;
                save();
                display();
            }
        };

        let delBtn=document.createElement("button");
        delBtn.innerText="Delete";
        delBtn.classList.add("remove-btn");
        delBtn.onclick=()=>{
            tasks.splice(index,1);
            save();
            display();
        };

        let btnGroup=document.createElement("div");
        btnGroup.classList.add("button-group");
        btnGroup.appendChild(editBtn);
        btnGroup.appendChild(delBtn);

        li.appendChild(span);
        li.appendChild(btnGroup);

        taskList.appendChild(li);
    });

    updateProgress(completedCount);
}

function dragStart(index){
    window.dragged=index;
}

function drop(index){
    let temp=tasks[window.dragged];
    tasks.splice(window.dragged,1);
    tasks.splice(index,0,temp);
    save();
    display();
}

function updateProgress(completed){
    let percent = tasks.length===0?0:(completed/tasks.length)*100;
    progressBar.style.width=percent+"%";
}

function clearCompleted(){
    tasks=tasks.filter(t=>!t.completed);
    save();
    display();
}

function exportToExcel(){

    if(tasks.length===0){
        alert("No tasks to export!");
        return;
    }

    let formattedData=tasks.map(t=>({
        Task:t.text,
        Category:t.category,
        Completed:t.completed?"Yes":"No"
    }));

    let ws=XLSX.utils.json_to_sheet(formattedData);
    let wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"Tasks");
    XLSX.writeFile(wb,"TaskManager.xlsx");
}

display();

</script>

</body>
</html>
